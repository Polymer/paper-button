<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
/**
 * @module Quantum Paper Elements
 */
/**
 * paper-button
 *
 * Example:
 *
 *    <paper-button></paper-button>
 *
 * @class paper-button
 */
-->

<link href="../polymer/polymer.html" rel="import">
<link href="../paper-ink/paper-ink.html" rel="import">

<polymer-element name="paper-button" attributes="inkColor centerInk pressed disabled" tabindex="-1" on-tap="{{tapAction}}" on-down="{{downAction}}" on-up="{{upAction}}">

  <template>

    <link href="paper-button.css" rel="stylesheet">

    <paper-ink id="ink" color="{{inkColor}}"></paper-ink>
    <div>
      <content></content>
    </div>

  </template>

  <script>
    Polymer('paper-button', {

      /**
       * The color of the ink that spreads when the button is tapped.
       *
       * @attribute inkColor
       * @type string
       * @default '#ccc'
       */
      inkColor: '#ccc',

      /**
       * If true, the ink will be centered in the button.
       *
       * @attribute centerInk
       * @type boolean
       * @default false
       */
      centerInk: false,

      /**
       * If true, the user is currently holding down the button.
       *
       * @attribute pressed
       * @type boolean
       * @default false
       */
      pressed: false,

      /**
       * If true, the user cannot interact with this button.
       *
       * @attribute disabled
       * @type boolean
       * @default false
       */
      disabled: false,

      ready: function() {
        this.disabledChanged();
      },

      disabledChanged: function() {
        if (this.disabled) {
          this.removeAttribute('tabindex');
        } else {
          this.setAttribute('tabindex', -1);
        }
      },

      waitForSpillCompleted: function(callback) {
        this.async(callback, null, (this.$.ink.spillCompleted ? 0 : this.duration));
      },

      resetInk: function() {
        this.pressed = false;
        this.$.ink.reset();
      },

      tapAction: function() {
        if (this.disabled) {
          return;
        }

        this.waitForSpillCompleted(function() {
          this.pressed = false;
          this.$.ink.evaporate();
        });
      },

      downAction: function(e) {
        if (this.disabled || e.button != 0) {
          return;
        }

        this.pressed = true;

        var rect = this.getBoundingClientRect();
        var inkSize = Math.max(rect.width, rect.height) * (this.centerInk ? 1 : 2);
        this.$.ink.style.height = inkSize + 'px';
        this.$.ink.style.width = inkSize + 'px';
        if (this.centerInk) {
          this.$.ink.style.left = (rect.width - inkSize) / 2 + 'px';
          this.$.ink.style.top = (rect.height - inkSize) / 2 + 'px';
        } else {
          this.$.ink.style.left = (e.x - rect.left - inkSize / 2) + 'px';
          this.$.ink.style.top = (e.y - rect.top - inkSize / 2) + 'px';
        }
        this.$.ink.spill();
      },

      insideButton: function(x, y) {
        var rect = this.getBoundingClientRect();
        return (rect.left <= x) && (x <= rect.right) && (rect.top <= y) && (y <= rect.bottom);
      },

      upAction: function(e) {
        if (this.disabled || e.button != 0) {
          return;
        }

        // wait for tap event to reset ink
        if (this.insideButton(e.x, e.y)) {
          return;
        }

        this.pressed = false;

        this.waitForSpillCompleted('resetInk');
      }

    });
  </script>
</polymer-element>
